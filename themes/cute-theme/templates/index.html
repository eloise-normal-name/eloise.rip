{% extends "base.html" %}

{% block content %}
<div class="home-page">
    <section class="recent-articles">
        <h2 class="section-title">
            Recent Posts
        </h2>
        {% for article in articles_page.object_list %}
            {% set metadata = article.metadata|default({}) %}
            {% set thumbnail = metadata.get('thumbnail') or metadata.get('image') or metadata.get('cover') or metadata.get('featured_image') or article.thumbnail or article.image %}
            {% set media_thumbnail = thumbnail %}
            {% set video_url = metadata.get('video') or article.video %}

            <article class="article-summary">
                <header class="article-summary-header">
                    <h3 class="article-summary-title">
                        <a href="{{ SITEURL }}/{{ article.url }}">{{ article.title }}</a>
                    </h3>
                    {% if media_thumbnail or video_url %}
                        <div class="article-summary-media">
                            <a href="{{ SITEURL }}/{{ article.url }}" aria-label="View {{ article.title|striptags }}">
                                {% if media_thumbnail %}
                                    {% if '://' in media_thumbnail %}
                                        <img src="{{ media_thumbnail }}" alt="{{ article.title|striptags }}">
                                    {% else %}
                                        <img src="{{ SITEURL }}/media/{{ media_thumbnail }}" alt="{{ article.title|striptags }}">
                                    {% endif %}
                                {% elif video_url %}
                                    {% set video_stem = video_url.split('/')[-1].rsplit('.', 1)[0] %}
                                    <img src="{{ SITEURL }}/media/video/{{ video_stem }}.jpg" alt="{{ article.title|striptags }}">
                                {% else %}
                                    <div class="video-placeholder" aria-hidden="true">‚ñ∂Ô∏è</div>
                                {% endif %}
                                {% if video_url %}
                                    <span class="media-badge media-badge-video" aria-hidden="true">‚ñ∂</span>
                                {% endif %}
                            </a>
                        </div>
                    {% endif %}
                    <div class="article-summary-meta">
                        <time class="published" datetime="{{ article.date.isoformat() }}">
                            üìÖ {{ article.date.strftime('%Y-%m-%d') }}
                        </time>
                        
                        {% if article.author %}
                            <span class="author">üë§ {{ article.author }}</span>
                        {% endif %}
                        
                        {% if article.category %}
                            <span class="category">üìÇ {{ article.category }}</span>
                        {% endif %}
                    </div>
                </header>

                <div class="article-summary-content">
                {% if article.summary %}
                    {{ article.summary }}
                {% else %}
                    {{ article.content|truncate(200) }}
                {% endif %}
                </div>
            
                {% if article.tags %}
                    <div class="article-summary-tags">
                        üè∑Ô∏è 
                        {% for tag in article.tags %}
                            <a href="{{ SITEURL }}/{{ tag.url }}" class="tag">{{ tag }}</a>{% if not loop.last %}{% endif %}
                        {% endfor %}
                    </div>
                {% endif %}
            </article>
        {% endfor %}
    </section>
    {% if articles_page.has_other_pages() %}
        <nav class="pagination">
            {% if articles_page.has_previous() %}
                <a href="{{ SITEURL }}/{{ articles_previous_page.url }}" class="prev">‚Üê Previous</a>
            {% endif %}
            
            <span class="page-number">Page {{ articles_page.number }} of {{ articles_paginator.num_pages }}</span>
            
            {% if articles_page.has_next() %}
                <a href="{{ SITEURL }}/{{ articles_next_page.url }}" class="next">Next ‚Üí</a>
            {% endif %}
        </nav>
    {% endif %}
</div>
{% endblock %}
