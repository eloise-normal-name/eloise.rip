{% macro responsive_image(image_name, alt_text="", class="", sizes="") %}
{#
  Generate a responsive <picture> element with modern image formats
  
  Args:
    image_name: Base name of the image (without extension)
    alt_text: Alt text for the image
    class: CSS classes to apply
    sizes: Sizes attribute for responsive images
#}
{% set site_url = SITEURL if SITEURL is defined else "" %}
{% set base_url = site_url + "/media/" + image_name %}
<picture{% if class %} class="{{ class }}"{% endif %}>
  <source srcset="{{ base_url }}.avif" type="image/avif">
  <source srcset="{{ base_url }}.webp" type="image/webp">
  <img src="{{ base_url }}.jpg" alt="{{ alt_text }}"{% if sizes %} sizes="{{ sizes }}"{% endif %} loading="lazy">
</picture>
{% endmacro %}

{% macro responsive_thumbnail(thumbnail_name, alt_text="", link_url="") %}
{#
  Generate a responsive thumbnail with optional link wrapper
  
  Args:
    thumbnail_name: Base name of the thumbnail (without extension)
    alt_text: Alt text for the image
    link_url: Optional URL to wrap the image in a link
#}
{% set site_url = SITEURL if SITEURL is defined else "" %}
{% set base_url = site_url + "/media/" + thumbnail_name %}
{% if link_url %}
<a href="{{ link_url }}" aria-label="{{ alt_text }}">
{% endif %}
  <picture>
    <source srcset="{{ base_url }}.avif" type="image/avif">
    <source srcset="{{ base_url }}.webp" type="image/webp">
    <img src="{{ base_url }}.jpg" alt="{{ alt_text }}" loading="lazy">
  </picture>
{% if link_url %}
</a>
{% endif %}
{% endmacro %}

{% macro get_image_stem(image_path) %}
{#
  Extract the image name without extension from a path
  e.g., "../media/jaws-2.jpg" -> "jaws-2"
#}
{% set filename = image_path.split('/')[-1] %}
{% set stem = filename.rsplit('.', 1)[0] %}
{{ stem }}
{% endmacro %}
